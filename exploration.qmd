---
title: "Exploration des données"
title-block-banner: false
description: | 
  Analyse descriptive des banques de données importées
date: "2022-12-20"
author:
  - name: "Juliana Hubacova"
    url: https://github.com/VOTREUSERNAME
    affiliation: FAS1002
    affiliation-url: https://FAS1002.github.io/A22
    orcid: 0000-0001-8128-783X
citation: true
bibliography: references.bib
format :
    html : 
        df-print: kable
---

```{r echo = false}
library(readxl)
library(tidyverse)
library(countrycode)
library(ggplot2)
library(plotly)
```

```{r echo=false}
co_2_data = read.csv('~/Desktop/Automne 2022/FAS1002/FAS1002_Projet_brouillon/owid-co2-data.csv')
life_exp_continent = read.csv("~/Desktop/Automne 2022/FAS1002/FAS1002_Projet_brouillon/bycontinents.csv")
life_exp_country = read_excel("~/Desktop/Automne 2022/FAS1002/FAS1002_Projet_brouillon/Copie de _GM-Life Expectancy- Dataset - v12.xlsx", 
    sheet = "data-for-countries-etc-by-year")

```

## Analyse descriptive

1.  Banque de données sur les émissions des CO2 et les gaz à effet de serre.

Cette banque de données contient de nombreuses informations sur les pays depuis 1850. Elle contient 46 523 observations et 74 variables. On y retrouve les pays, leur population, leur PIB, et leurs émissions de dioxyde de carbone et gaz à effets de serre. 

```{r}
# base de données
glimpse(co_2_data)
```

À première vue, on peut constater les différents facteurs qui influents les émissions de dioxyde de carbone et des gaz à effets de serre. On retrouve notamment l'utilisation du ciment, du charbon, du gaz, du méthane, du nitrate, de la combustion, et autres. Ces variables vont être utiliser plus tard dans l'analyse. J'aimerais d'abord me concentrer sur le PIB des pays et des continents car cette variable nous permet de constater la santé économque d'un pays. 

```{r co2, message=false, warning= false}
# Choix de variables et ajout de continents
co_2_data2 = co_2_data %>% 
  select(country, year, population, gdp, ends_with("per_capita"), primary_energy_consumption, total_ghg) %>% 
  mutate(continent = countrycode(co_2_data$iso_code, "iso3c", "continent"))

# Variables manquantes 
missing = co_2_data2 %>% 
  select(country, continent) %>% 
  filter(!complete.cases(.))

# Retrait des continents dans la colonne des pays 
co_2_data3 = co_2_data2 %>% 
  drop_na(continent)
co_2_data3 = as_tibble(co_2_data3)

# Ajout de la variable du PIB par habitant
co_2_data4 = co_2_data3 %>% 
    mutate(gdp_per_capita = gdp/population)

# Moyenne du PIB/habitant par pays
co_2_data5 = co_2_data4 %>% 
    group_by(country) %>% 
    summarise(gdp_per_capita = mean(gdp_per_capita, na.rm = TRUE)) %>% 
    ungroup()

# Les pays ayant un PIB par habitant faible
co_2_data5 %>% 
    arrange(gdp_per_capita)

#Les pays ayant un PIB par habitant élevé
co_2_data5 %>% 
    arrange(- gdp_per_capita)
```

On constate que les pays avec le plus faible PIB par habitant sont le Burundi, la Guinée, le Malawi et l'Éthiopie. Ces pays font partie des pays qu'on considère comme sous-développé. Tandis que les pays les plus développé économiquement connaissent un PIB par habitant plus élevé. Le pays avec un PIB par habitant le plus élevé est le Qatar avec un montant de 60 018 USD (dollars constants de 2011).
Mais qu'en est-il d'un point de vue des continents?

```{r}
# Moyenne du PIB par habitant par continent
co_2_data6 = co_2_data3 %>% 
    group_by(continent) %>% 
    summarise(gdp = mean(gdp, na.rm = TRUE)) %>% 
    ungroup() %>% 
    rename("gdp_usd_2011" = "gdp") %>% 
    arrange(gdp_usd_2011)

ggplot(data = co_2_data6, 
       mapping = aes(x = continent, y = gdp_usd_2011)) +
    geom_bar(stat = "identity", fill = "#C5D8E1") + 
    labs(title = "PIB par habitant en fonction des continents", 
         subtitle = "À partir des données de Our World in Data", 
         x = "Continents", 
         y = "PIB par habitant") +
    scale_x_discrete(limits = c("Asia", "Americas", "Europe", "Oceania", "Africa")) +
    theme_bw()
```

On constate que l'Asie et l'Amérique sont les continents ayant le PIB par habitant le plus élevé. Tandis que l'Afrique se retrouve avec le PIB par habitant le moins élevé. Ceci n'est pas surprenant puisque les pays en développement se trouve majoritairement en Afrique et les grandes puissances économiques, Chine et États-Unis, se trouvent respectivement en Asie et en Amérique. 

2.  Banque de donnée sur l'espérance de vie à la naissance.

Le PIB par habitant est un indicateur économique puissant qui nous permet de constater le comportement économique d'un pays. Maintenant, on se focalise sur l'espérance de vie pour voir comment celle-ci a évolué au cours du temps et des régions. 

```{r message=FALSE, warning=false}
# base de données 
glimpse(life_exp_country)

# Changement de nom de variables (en lien avec la base de données CO2)
life_exp_country2 = life_exp_country %>% 
    rename("country" = "name") %>% 
    rename("year" = "time") %>% 
    rename("lifeexp" = "Life expectancy")

# Continents
unique(life_exp_country2$country)
unique(life_exp_country2$geo)
life_exp_country3 = life_exp_country2 %>% 
    mutate(continent = countrycode(life_exp_country$geo, "genc3c", "continent"))
unique(life_exp_country3$continent)
```
 
La base de données *Life Expectancy at Birth* contient 56 616 observations et 4 variables. On y retrouve les pays, leur code genc3c (GENC à 3 lettres), les années et leur espérance de vie.
On constate qu'il n'y a pas de données pour l'Océanie.

```{r}
# Utilisation de le feuille de calcul sur les continents
life_exp_continent2 = life_exp_continent %>% 
    rename("continent" = "name") %>% 
    rename("year" = "time") %>% 
    rename("lifeexp" = "Life.expectancy")

ggplot(data = life_exp_continent2, 
       mapping = aes(x = year, y = lifeexp, group = continent, color = continent)) +
    geom_line() +
    geom_vline(xintercept =year(Sys.time()), colour = "black", alpha = .6, linetype = "dashed") +
    annotate("text", x = year(Sys.time()), y = 50, label = "Cette année", size = 3, color = "black", alpha = .6) +
    labs(title = "Évolution de l'espérance de vie à la naissance", 
         subtitle = "À partir des données de Gapminder",
         x = "Années", 
         y = "Espérance de vie à la naissance") +
    scale_color_discrete(name = "Continent", labels = c("Afrique", "Asie", "Europe", "Amérique")) +
    theme_bw()
```

On constate que l'espérance de vie a augmenté au cours des années. Ceci peut notamment être dû à des avancées médicales, des meilleures conditions de vie et d'hygiène. De plus, on peut observer que l'espérance de vie à la naissance la plus élevée se trouve en Europe, suivie de l'Amérique. L'Afrique se trouve au bas de l'échelle. À nouveau, l'Afrique qui se compose des pays en développement se trouve en dernière position du classement. Existe-t-il une relation entre le PIB par habitant et l'espérance de vie à la naissance?

## Lien entre PIB par habitant et espérance de vie à la naissance

```{r}
# Combinaison des deux bases de données
co2_life_exp = merge(co_2_data4, life_exp_country2, by = c("country", "year"))

# Données manquantes pour le PIB
missing_gdp = co2_life_exp %>% 
  select(country, gdp, year) %>% 
  filter(!complete.cases(.))
# La plus grande différence entre le manque de donnée
a = table(missing_gdp$year)
unclass(a)
number_missing = tibble(a)
number_missing = number_missing %>% 
    mutate(diff = a - lag(a))
max(number_missing, na.rm = TRUE)
```

La plus grande différence de donnée manquante se trouve entre 1949 et 1950. L'analyse va donc se faire à partir de 1950, où un grand nombre de données sont disponibles comparé aux années précédentes. 

```{r}
# À partir de 1950
co2_life_exp2 = co2_life_exp %>% 
    filter(year >1949)

# Graphiquement
plot_ly(data = co2_life_exp2, x = ~gdp_per_capita, y = ~lifeexp, color = ~continent, frame = ~year)
```
